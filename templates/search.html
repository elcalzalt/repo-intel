{% extends "layout.html" %}
{% block content %}
<main>
    <form action="/search" method="get" class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" name="q" id="searchInput" placeholder="Search for repositories, topics..."
            value="{{ query }}" />

        <details class="filter-panel" open>
            <summary class="filter-summary">⚙️ Advanced Filters</summary>
            <div class="filters">

                <!-- Language -->
                <div class="filter-group">
                    <label for="language">Language</label>
                    <input type="text" id="language" name="language" placeholder="e.g. Python"
                        value="{{ request.args.get('language', '') }}">
                </div>

                <!-- Stars -->
                <div class="filter-group">
                    <label for="stars">Stars</label>
                    <input type="text" id="stars" name="stars" placeholder="e.g. >100, <500"
                        value="{{ request.args.get('stars', '') }}">
                </div>

                <!-- Forks -->
                <div class="filter-group">
                    <label for="forks">Forks</label>
                    <input type="text" id="forks" name="forks" placeholder="e.g. >=10"
                        value="{{ request.args.get('forks', '') }}">
                </div>

                <!-- Size -->
                <div class="filter-group">
                    <label for="size">Size (KB)</label>
                    <input type="text" id="size" name="size" placeholder="e.g. <500"
                        value="{{ request.args.get('size', '') }}">
                </div>

                <!-- Created -->
                <div class="filter-group">
                    <label for="created">Created After</label>
                    <input type="date" id="created" name="created" value="{{ request.args.get('created', '') }}">
                </div>

                <!-- Pushed -->
                <div class="filter-group">
                    <label for="pushed">Updated After</label>
                    <input type="date" id="pushed" name="pushed" value="{{ request.args.get('pushed', '') }}">
                </div>

                <!-- License -->
                <div class="filter-group">
                    <label for="license">License</label>
                    <input type="text" id="license" name="license" placeholder="e.g. mit, apache-2.0"
                        value="{{ request.args.get('license', '') }}">
                </div>

                <!-- Archived -->
                <div class="filter-group">
                    <label for="archived">Archived</label>
                    <select id="archived" name="archived">
                        <option value="">Any</option>
                        <option value="true" {% if request.args.get('archived')=='true' %}selected{% endif %}>Yes
                        </option>
                        <option value="false" {% if request.args.get('archived')=='false' %}selected{% endif %}>No
                        </option>
                    </select>
                </div>

                <!-- Mirror -->
                <div class="filter-group">
                    <label for="mirror">Mirror</label>
                    <select id="mirror" name="mirror">
                        <option value="">Any</option>
                        <option value="true" {% if request.args.get('mirror')=='true' %}selected{% endif %}>Yes</option>
                        <option value="false" {% if request.args.get('mirror')=='false' %}selected{% endif %}>No
                        </option>
                    </select>
                </div>

                <!-- Visibility -->
                <!-- <div class="filter-group">
                    <label for="visibility">Visibility</label>
                    <select id="visibility" name="is">
                        <option value="">Any</option>
                        <option value="public" {% if request.args.get('is')=='public' %}selected{% endif %}>Public
                        </option>
                        <option value="private" {% if request.args.get('is')=='private' %}selected{% endif %}>Private
                        </option>
                    </select>
                </div> -->

                <!-- Topic -->
                <div class="filter-group">
                    <label for="topic">Topic</label>
                    <input type="text" id="topic" name="topic" placeholder="e.g. machine-learning"
                        value="{{ request.args.get('topic', '') }}">
                </div>

                <!-- User -->
                <div class="filter-group">
                    <label for="user">User</label>
                    <input type="text" id="user" name="user" placeholder="e.g. octocat"
                        value="{{ request.args.get('user', '') }}">
                </div>

                <!-- Organization -->
                <div class="filter-group">
                    <label for="org">Organization</label>
                    <input type="text" id="org" name="org" placeholder="e.g. google"
                        value="{{ request.args.get('org', '') }}">
                </div>

                <!-- Submit -->
                <div class="filter-group">
                    <button type="submit" class="filter-btn">Apply Filters</button>
                </div>
            </div>
        </details>


    </form>


    {% if results %}
    <div class="repo-cards">
        {% for repo in results %}
        <form method="post" action="{{ url_for('repo_analysis', repo_name=repo.name) }}" class="repo-card"
            onclick="this.submit()">
            <input type="hidden" name="full_name" value="{{ repo.name }}" />
            <input type="hidden" name="name" value="{{ repo.name.split('/')[-1] }}" />
            <input type="hidden" name="owner" value="{{ repo.name.split('/')[0] }}" />
            <input type="hidden" name="description" value="{{ repo.description }}" />
            <input type="hidden" name="url" value="{{ repo.url }}" />
            <input type="hidden" name="stars" value="{{ repo.stars }}" />
            <input type="hidden" name="forks" value="{{ repo.forks }}" />
            <input type="hidden" name="updated_at" value="{{ repo.updated_at }}" />
            <h3>{{ repo.name }}</h3>
            <p>{{ repo.description }}</p>
            <small>⭐ {{ repo.stars }}</small>
            <div class="repo-actions">
                <span class="action-hint">Click to analyze →</span>
            </div>
        </form>
        {% endfor %}
    </div>
    {% else %}
    <p>No results found.</p>
    {% endif %}
</main>
{% endblock content %}